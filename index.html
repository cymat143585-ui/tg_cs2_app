<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mcrystals</title>
<style>
body { background:#000; color:#fff; font-family:Arial,sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; margin:0; }
#crystalsCount { font-size:2em; margin-bottom:20px; }
h1 { font-size:3em; margin-bottom:40px; }
.tasks-box { border:2px solid #fff; border-radius:15px; padding:20px; margin:10px auto; width:300px; text-align:center; background-color:#111; }
.tasks-box button { margin-top:10px; padding:10px 20px; border-radius:10px; border:none; background:#4caf50; color:#fff; font-size:1em; cursor:pointer; }
.tasks-box a button { width:100%; }
.modal { display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
.modal-content { background-color:#222; color:#fff; padding:20px; border-radius:15px; text-align:center; width:300px; }
.modal-content button { margin-top:15px; background-color:#f44336; padding:8px 16px; cursor:pointer; border:none; border-radius:8px; }
</style>
</head>
<body>

<div id="crystalsCount">üíé 0 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</div>
<h1>Mcrystals</h1>

<div class="tasks-box" id="task1">
    <p>–ó–∞–¥–∞–Ω–∏–µ 1: –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª</p>
    <a href="https://t.me/skin_master_gdd" target="_blank" onclick="startCheckSub()">
        <button>–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram</button>
    </a>
</div>

<div class="tasks-box">
    <p>–ó–∞–¥–∞–Ω–∏–µ 2: –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</p>
    <button onclick="addCrystals(100)">–í—ã–ø–æ–ª–Ω–∏—Ç—å (+100)</button>
</div>

<div class="tasks-box">
    <p>–ó–∞–¥–∞–Ω–∏–µ 3: –ó–∞–±–µ—Ä–∏—Ç–µ –±–æ–Ω—É—Å</p>
    <button onclick="addCrystals(50)">–í—ã–ø–æ–ª–Ω–∏—Ç—å (+50)</button>
</div>

<div id="errorModal" class="modal">
    <div class="modal-content">
        <p id="errorText">‚ùå –û—à–∏–±–∫–∞</p>
        <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
let crystals = 0;
const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 12345;

// --- –∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ ---
async function loadCrystals() {
    const res = await fetch("get_crystals.php?user_id=" + userId);
    const data = await res.json();
    crystals = data.crystals || 0;

    document.getElementById("crystalsCount").innerText =
        `üíé ${crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
}

// --- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä ---
async function saveCrystals() {
    await fetch("save_crystals.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            user_id: userId,
            crystals: crystals
        })
    });
}

async function addCrystals(amount) {
    crystals += amount;

    const counter = document.getElementById("crystalsCount");
    counter.style.transform = "scale(1.3)";
    setTimeout(() => counter.style.transform = "scale(1)", 300);

    counter.innerText = `üíé ${crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    saveCrystals();
}

function showModal(message) {
    document.getElementById("errorText").innerText = message;
    document.getElementById("errorModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("errorModal").style.display = "none";
}

// –ø—Ä–∏–º–µ—Ä (–æ—Å—Ç–∞–≤–ª—è—é –∫–∞–∫ –±—ã–ª–æ)
async function checkSub() {
    try {
        const response = await fetch("http://192.168.1.6:5000", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: userId })
        });

        const data = await response.json();

        if (data.subscribed) {
            addCrystals(data.reward);
            showModal(`‚úî –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å! üíé +${data.reward} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`);
        } else {
            showModal("‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª");
        }
    } catch (err) {
        showModal("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏");
    }
}

function startCheckSub() {
    setTimeout(checkSub, 5000);
}

// –∑–∞–≥—Ä—É–∂–∞–µ–º –∫—Ä–∏—Å—Ç–∞–ª–ª—ã —Å—Ä–∞–∑—É
loadCrystals();
</script>


</body>
</html>















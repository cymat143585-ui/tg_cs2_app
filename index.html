<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mcrystals</title>

<style>
body {
    background:#000; color:#fff; font-family:Arial,sans-serif;
    display:flex; flex-direction:column; align-items:center;
    justify-content:center; min-height:100vh; margin:0;
}
#crystalsCount { font-size:2em; margin-bottom:20px; }
h1 { font-size:3em; margin-bottom:40px; }
.tasks-box {
    border:2px solid #fff; border-radius:15px; padding:20px;
    margin:10px auto; width:300px; text-align:center; background-color:#111;
}
.tasks-box button {
    margin-top:10px; padding:10px 20px; border-radius:10px;
    border:none; background:#4caf50; color:#fff; font-size:1em; cursor:pointer;
}
.modal {
    display:none; position:fixed; z-index:100; left:0; top:0;
    width:100%; height:100%; background-color:rgba(0,0,0,0.7);
    justify-content:center; align-items:center;
}
.modal-content {
    background-color:#222; color:#fff; padding:20px; border-radius:15px;
    text-align:center; width:300px;
}
.modal-content button {
    margin-top:15px; background-color:#f44336; padding:8px 16px;
    cursor:pointer; border:none; border-radius:8px;
}
</style>
</head>

<body>

<div id="crystalsCount">üíé 0 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</div>
<h1>Mcrystals</h1>

<div class="tasks-box">
    <p>–ó–∞–¥–∞–Ω–∏–µ 1: –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª</p>
    <a href="https://t.me/skin_master_gdd" target="_blank">
        <button onclick="startCheckSub()">–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram</button>
    </a>
</div>

<div class="tasks-box">
    <p>–ó–∞–¥–∞–Ω–∏–µ 2: –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</p>
    <button onclick="addCrystals(100)">–í—ã–ø–æ–ª–Ω–∏—Ç—å (+100)</button>
</div>

<div class="tasks-box">
    <p>–ó–∞–¥–∞–Ω–∏–µ 3: –ó–∞–±–µ—Ä–∏—Ç–µ –±–æ–Ω—É—Å</p>
    <button onclick="addCrystals(50)">–í—ã–ø–æ–ª–Ω–∏—Ç—å (+50)</button>
</div>

<div id="errorModal" class="modal">
    <div class="modal-content">
        <p id="errorText">‚ùå –û—à–∏–±–∫–∞</p>
        <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
// üëâ –£–ö–ê–ñ–ò –°–í–û–ô URL Cloud Run
const API = "https://tg-cs2-app-367215807460.asia-northeast1.run.app";

let crystals = 0;
const userId = 12345; // –µ—Å–ª–∏ –±—É–¥–µ—à—å –¥–µ–ª–∞—Ç—å Telegram WebApp ‚Äî –∑–∞–º–µ–Ω–∏–º

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
async function loadCrystals() {
    try {
        const res = await fetch(`${API}/get_crystals.php?user_id=${userId}`);
        const data = await res.json();
        crystals = data.crystals ?? 0;

        document.getElementById("crystalsCount").innerText =
            `üíé ${crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
    } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
async function saveCrystals() {
    try {
        await fetch(`${API}/save_crystals.php`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: userId, crystals })
        });
    } catch (e) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
    }
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
function addCrystals(amount) {
    crystals += amount;
    document.getElementById("crystalsCount").innerText =
        `üíé ${crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
    saveCrystals();
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function showModal(msg) {
    document.getElementById("errorText").innerText = msg;
    document.getElementById("errorModal").style.display = "flex";
}
function closeModal() {
    document.getElementById("errorModal").style.display = "none";
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
async function checkSub() {
    try {
        const res = await fetch(`${API}/check_sub.php`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: userId })
        });

        const data = await res.json();

        if (data.subscribed) {
            addCrystals(data.reward);
            showModal(`‚úî –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å! üíé +${data.reward}`);
        } else {
            showModal("‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã");
        }
    } catch (e) {
        showModal("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
    }
}

function startCheckSub() {
    setTimeout(checkSub, 5000);
}

loadCrystals();
</script>

</body>
</html>













